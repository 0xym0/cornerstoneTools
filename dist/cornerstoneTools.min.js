/*! cornerstoneTools - v0.0.1 - 2014-04-05 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneTools */
var cornerstoneTools=function(a,b,c){"use strict";function d(a){if(!("mousewheel"===a.originalEvent.type&&0===a.originalEvent.wheelDeltaY||"DOMMouseScroll"===a.originalEvent.type&&1===a.originalEvent.axis)){var c=a.currentTarget,d=b.pageToImage(c,a.pageX,a.pageY);a=window.event||a;var e=a.wheelDelta||-a.detail||-a.originalEvent.detail,f=Math.max(-1,Math.min(1,e)),g=({element:c,viewport:b.getViewport(c),image:b.getEnabledElement(c).image,direction:f,pageX:a.pageX,pageY:a.pageY,imageX:d.x,imageY:d.y},new CustomEvent("CornerstoneToolsMouseWheel",{detail:{event:a,direction:f,viewport:b.getViewport(c),image:b.getEnabledElement(c).image,element:c},bubbles:!1,cancelable:!1}));c.dispatchEvent(g)}}function e(b){a(b).on(g,d)}function f(b){a(b).unbind(g,d)}void 0===c&&(c={});var g="mousewheel DOMMouseScroll";return c.mouseWheelInput={enable:e,disable:f},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(d){function e(a){var d={page:c.point.pageToPoint(a),image:b.pageToImage(g,a.pageX,a.pageY)},e={page:c.point.subtract(d.page,i.page),image:c.point.subtract(d.image,i.image)},f=new CustomEvent("CornerstoneToolsMouseMove",{detail:{event:a,which:k,viewport:b.getViewport(g),image:b.getEnabledElement(g).image,element:g,startPoints:h,lastPoints:i,currentPoints:d,deltaPoints:e},bubbles:!1,cancelable:!1});return g.dispatchEvent(f),i=c.copyPoints(d),c.pauseEvent(a)}function f(d){var j={page:c.point.pageToPoint(d),image:b.pageToImage(g,d.pageX,d.pageY)},l={page:c.point.subtract(j.page,i.page),image:c.point.subtract(j.image,i.image)},m=new CustomEvent("CornerstoneToolsMouseUp",{detail:{event:d,which:k,viewport:b.getViewport(g),image:b.getEnabledElement(g).image,element:g,startPoints:h,lastPoints:i,currentPoints:j,deltaPoints:l},bubbles:!1,cancelable:!1});g.dispatchEvent(m),a(document).unbind("mousemove",e),a(document).unbind("mouseup",f)}var g=(d.data,d.currentTarget),h={page:c.point.pageToPoint(d),image:b.pageToImage(g,d.pageX,d.pageY)},i=c.copyPoints(h),j=new CustomEvent("CornerstoneToolsMouseDown",{detail:{event:d,which:d.which,viewport:b.getViewport(g),image:b.getEnabledElement(g).image,element:g,startPoints:h,lastPoints:i,currentPoints:h,deltaPoints:{x:0,y:0}},bubbles:!1,cancelable:!1});g.dispatchEvent(j);var k=d.which;return a(document).on("mousemove",e),a(document).on("mouseup",f),c.pauseEvent(d)}function e(b){a(b).on("mousedown",d)}function f(b){a(b).unbind("mousedown",d)}return void 0===c&&(c={}),c.mouseInput={enable:e,disable:f},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,b){var c=1<<a-1;return 0!==(b&c)}function e(b){var c={activate:function(c,d){a(c).off("CornerstoneToolsMouseMove",b);var e={mouseButtonMask:d};a(c).on("CornerstoneToolsMouseMove",e,b)},disable:function(c){a(c).off("CornerstoneToolsMouseDown",b)},enable:function(c){a(c).off("CornerstoneToolsMouseDown",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseDown",b)}};return c}return void 0===c&&(c={}),c.mouseButtonTool=e,c.isMouseButtonEnabled=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsMouseWheel",b);var d={};a(c).on("CornerstoneToolsMouseWheel",d,b)},disable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},enable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseWheel",b)}};return c}return void 0===c&&(c={}),c.mouseWheelTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchDrag",b);var d={};a(c).on("CornerstoneToolsTouchDrag",d,b)},disable:function(c){a(c).off("CornerstoneToolsTouchDrag",b)},enable:function(c){a(c).off("CornerstoneToolsTouchDrag",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchDrag",b)}};return c}return void 0===c&&(c={}),c.touchDragTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchPinch",b);var d={};a(c).on("CornerstoneToolsTouchPinch",d,b)},disable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},enable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchPinch",b)}};return c}return void 0===c&&(c={}),c.touchPinchTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){var d=a.originalEvent.detail;c.isMouseButtonEnabled(d.which,a.data.mouseButtonMask)&&(d.viewport.centerX+=d.deltaPoints.page.x/d.viewport.scale,d.viewport.centerY+=d.deltaPoints.page.y/d.viewport.scale,b.setViewport(d.element,d.viewport))}function e(a,c){c.viewport.centerX+=c.deltaPageX/c.viewport.scale,c.viewport.centerY+=c.deltaPageY/c.viewport.scale,b.setViewport(a,c.viewport)}function f(a){c.onDrag(a,e)}return void 0===c&&(c={}),c.pan=c.mouseButtonTool(d),c.panTouchDrag=c.touchDragTool(f),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function f(a){({visible:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}});d.addToolState(e.currentTarget,toolType,data)}function g(){console.log("mouseMoveCallback")}function h(a){console.log("mouseDownCallback");var b=a.data,c=a.originalEvent.detail;if(d.isMouseButtonEnabled(a.which,b.mouseButtonMask)){console.log("down");{c.element,c.viewport,c.startPoints.image}if(b.active===!0)return f(c),void a.stopImmediatePropagation()}}function i(a){console.log("onImageRendered");var b=a.originalEvent.detail.canvasContext.canvas.getContext("2d");c.setToPixelCoordinateSystem(a.originalEvent.detail.enabledElement,b),b.beginPath(),b.beginPath(),b.strokeStyle="white",b.lineWidth=1/a.originalEvent.detail.viewport.scale,b.moveTo(0,0),b.lineTo(256,256),b.stroke()}function j(c){console.log("disable"),a(c).off("CornerstoneImageRendered",i),a(c).off("CornerstoneToolsMouseMove",g),a(c).off("CornerstoneToolsMouseDown",h),b.updateImage(c)}function k(c){console.log("enable"),a(c).on("CornerstoneImageRendered",i),a(c).off("CornerstoneToolsMouseMove",g),a(c).off("CornerstoneToolsMouseDown",h),b.updateImage(c)}function l(c,d){console.log("activate"),a(c).on("CornerstoneImageRendered",i);var e={mouseButtonMask:d,active:!0};a(c).on("CornerstoneToolsMouseMove",e,g),a(c).on("CornerstoneToolsMouseDown",e,h),b.updateImage(c)}function m(c,d){console.log("deactivate"),a(c).on("CornerstoneImageRendered",i);var e={mouseButtonMask:d,active:!1};a(c).on("CornerstoneToolsMouseMove",e,g),a(c).on("CornerstoneToolsMouseDown",e,h),b.updateImage(c)}return void 0===d&&(d={}),d.probe={enable:k,disable:j,activate:l,deactivate:m},d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){var d=a.originalEvent.detail;if(c.isMouseButtonEnabled(d.which,a.data.mouseButtonMask)){var e=d.image.maxPixelValue-d.image.minPixelValue,f=e/1024;d.viewport.windowWidth+=d.deltaPoints.page.x*f,d.viewport.windowCenter+=d.deltaPoints.page.y*f,b.setViewport(d.element,d.viewport)}}function e(a){var c=a.originalEvent.detail,d=c.image.maxPixelValue-c.image.minPixelValue,e=d/1024;c.viewport.windowWidth+=c.deltaPoints.page.x*e,c.viewport.windowCenter+=c.deltaPoints.page.y*e,b.setViewport(c.element,c.viewport)}return void 0===c&&(c={}),c.wwwc=c.mouseButtonTool(d),c.wwwcTouchDrag=c.touchDragTool(e),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,c,d){var e=1.7,f=Math.log(c.scale)/Math.log(e),g=f+d,h=Math.pow(e,g);c.scale=h,b.setViewport(a,c)}function e(a){var e=a.originalEvent.detail;if(c.isMouseButtonEnabled(e.which,a.data.mouseButtonMask)){var f=e.deltaPoints.page.y/100;d(e.element,e.viewport,f);var g=b.pageToImage(e.element,e.startPoints.page.x,e.startPoints.page.y);e.viewport.centerX-=e.startPoints.image.x-g.x,e.viewport.centerY-=e.startPoints.image.y-g.y,b.setViewport(e.element,e.viewport)}return!1}function f(a){var b=a.originalEvent.detail,c=-b.direction/4;d(b.element,b.viewport,c)}function g(a){var b=a.originalEvent.detail;d(b.element,b.viewport,b.direction/4)}return void 0===c&&(c={}),c.zoom=c.mouseButtonTool(e),c.zoomWheel=c.mouseWheelTool(f),c.zoomTouchPinch=c.touchPinchTool(g),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(d){if(d.gesture.preventDefault(),d.gesture.stopPropagation(),j!==!0){var e,f=d.currentTarget;if("transform"===d.type){var k=i-d.gesture.scale;i=d.gesture.scale,e=new CustomEvent("CornerstoneToolsTouchPinch",{detail:{event:d,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,direction:0>k?1:-1},bubbles:!1,cancelable:!1})}else{if("dragstart"===d.type)return g={page:c.point.pageToPoint(d.gesture.touches[0]),image:b.pageToImage(f,d.gesture.touches[0].pageX,d.gesture.touches[0].pageY)},void(h=c.copyPoints(g));if("drag"!==d.type)return;var l={page:c.point.pageToPoint(d.gesture.touches[0]),image:b.pageToImage(f,d.gesture.touches[0].pageX,d.gesture.touches[0].pageY)},m={page:c.point.subtract(l.page,h.page),image:c.point.subtract(l.image,h.image)};e=new CustomEvent("CornerstoneToolsTouchDrag",{detail:{event:d,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,startPoints:g,lastPoints:h,currentPoints:l,deltaPoints:m},bubbles:!1,cancelable:!1}),h=a.extend({},l)}j=!0,setTimeout(function(){f.dispatchEvent(e),j=!1},1)}}function e(b){var c={transform_always_block:!0,transform_min_scale:.01,drag_block_horizontal:!0,drag_block_vertical:!0,drag_min_distance:0};a(b).hammer(c).on("touch drag transform dragstart",d)}function f(b){a(b).hammer().off("touch drag transform dragstart",d)}void 0===c&&(c={});var g,h,i=1,j=!1;return c.touchInput={enable:e,disable:f},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){return{x:a.pageX,y:a.pageY}}function e(a,b){return{x:a.x-b.x,y:a.y-b.y}}function f(a){return{x:a.x,y:a.y}}return void 0===c&&(c={}),c.point={subtract:e,copy:f,pageToPoint:d},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(){function a(a,c,e){var f=b.getEnabledElement(a);d.hasOwnProperty(f.ids.imageId)===!1&&(d[f.ids.imageId]={});var g=d[f.ids.imageId];g.hasOwnProperty(c)===!1&&(g[c]={data:[]});var h=g[c];h.data.push(e)}function c(a,c){var e=b.getEnabledElement(a);if(d.hasOwnProperty(e.ids.imageId)===!1)return void 0;var f=d[e.ids.imageId];if(f.hasOwnProperty(c)===!1)return void 0;var g=f[c];return g}var d={},e={get:c,add:a};return e}void 0===d&&(d={});var f=e();return d.newImageIdSpecificToolStateManager=e,d.globalImageIdSpecificToolStateManager=f,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(a){var c=b.getEnabledElement(a);return void 0===c.toolStateManager&&(c.toolStateManager=d.globalImageIdSpecificToolStateManager),c.toolStateManager}function f(a,b,c){toolStateManager=e(a),toolStateManager.add(a,b,c)}function g(a,b){return toolStateManager=e(a),toolStateManager.get(a,b)}function h(a,c){var d=b.getEnabledElement(a);d.toolStateManager=c}return void 0===d&&(d={}),d.addToolState=f,d.getToolState=g,d.setElementToolStateManager=h,d.getElementToolStateManager=e,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){var b=c.point.copy(a.page),d=c.point.copy(a.image);return{page:b,image:d}}return void 0===c&&(c={}),c.copyPoints=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}return void 0===c&&(c={}),c.pauseEvent=d,c}($,cornerstone,cornerstoneTools);